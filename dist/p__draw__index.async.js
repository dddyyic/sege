(self.webpackChunkfabric_video_editor=self.webpackChunkfabric_video_editor||[]).push([[803],{58858:function(xa,Me,C){"use strict";C.r(Me),C.d(Me,{default:function(){return Ur}});var yr=C(17061),T=C.n(yr),kr=C(17156),ae=C.n(kr),Dr=C(861),re=C.n(Dr),Cr=C(27424),P=C.n(Cr),k=C(67294),q=C(32777),s=C(92914),Fr=C(53780),Te=C(78957),Le=C(50457),ie=C(24697),N=C(69413),Zr=C(30568),Pr=C(33808),ze=C(74330),Ar=C(51947),Br=C(52645),Ue=C(10149),We=C(48689),xr=C(23430),jr=C(88484),Ir=C(16596),ja=function(R){return R.TOPS="tops",R.PANTS="pants",R.SKIRT="skirt",R.DRESS="dress",R.SHOES="shoes",R.HAT="hat",R.BAG="bag",R.COAT="coat",R}({}),Rr=function(R){return R.TRANSPARENT="transparent",R.WHITE_BG="whiteBK",R}({}),Or="http://localhost:8861/api/segment",Mr=function(){var R=ae()(T()().mark(function Q(f){var A,B,le,se,Y,p,U,Ze,me=arguments;return T()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(A=me.length>1&&me[1]!==void 0?me[1]:Rr.TRANSPARENT,w.prev=1,f){w.next=4;break}throw new Error("\u56FE\u50CF\u6570\u636E\u4E3A\u7A7A");case 4:return se=f.startsWith("data:")?f:"data:image/jpeg;base64,".concat(f),w.next=7,fetch(Or,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:se,output_mode:A})});case 7:if(Y=w.sent,Y.ok){w.next=10;break}throw new Error("\u670D\u52A1\u5668\u54CD\u5E94\u9519\u8BEF: ".concat(Y.status));case 10:return w.next=12,Y.json();case 12:if(p=w.sent,!p.image){w.next=15;break}return w.abrupt("return",p.image);case 15:if(!((B=p.result)!==null&&B!==void 0&&B.image)){w.next=17;break}return w.abrupt("return",p.result.image);case 17:if(!((le=p.data)!==null&&le!==void 0&&le.result)){w.next=19;break}return w.abrupt("return",p.data.result);case 19:if(!p.base64){w.next=21;break}return w.abrupt("return",p.base64);case 21:if(!p.url){w.next=39;break}return w.prev=22,w.next=25,fetch(p.url);case 25:if(U=w.sent,U.ok){w.next=28;break}throw new Error("\u4E0B\u8F7D\u56FE\u50CF\u5931\u8D25: ".concat(U.status));case 28:return w.next=30,U.blob();case 30:return Ze=w.sent,w.next=33,Tr(Ze);case 33:return w.abrupt("return",w.sent);case 36:return w.prev=36,w.t0=w.catch(22),w.abrupt("return",p.url);case 39:return w.abrupt("return",null);case 42:throw w.prev=42,w.t1=w.catch(1),w.t1;case 45:case"end":return w.stop()}},Q,null,[[1,42],[22,36]])}));return function(f){return R.apply(this,arguments)}}(),Tr=function(Q){return new Promise(function(f,A){var B=new FileReader;B.onload=function(){return f(B.result)},B.onerror=A,B.readAsDataURL(Q)})},Lr=function(){var R=ae()(T()().mark(function Q(f){return T()().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.abrupt("return",new Promise(function(le,se){try{var Y=new Image;Y.crossOrigin="anonymous",Y.onload=function(){var p=document.createElement("canvas");p.width=Y.width,p.height=Y.height;var U=p.getContext("2d");if(!U){se(new Error("\u65E0\u6CD5\u521B\u5EFA\u753B\u5E03\u4E0A\u4E0B\u6587"));return}U.fillStyle="white",U.fillRect(0,0,p.width,p.height),U.drawImage(Y,0,0),le(p.toDataURL("image/png",1))},Y.onerror=function(){return se(new Error("\u52A0\u8F7D\u56FE\u50CF\u5931\u8D25"))},Y.src=f}catch(p){se(p)}}));case 1:case"end":return B.stop()}},Q)}));return function(f){return R.apply(this,arguments)}}(),c=C(85893),X=function(Q){for(var f=arguments.length,A=new Array(f>1?f-1:0),B=1;B<f;B++)A[B-1]=arguments[B];return A.includes(Q)},zr=function(){var Q=(0,k.useRef)(null),f=(0,k.useRef)(null),A=(0,k.useRef)(null),B=(0,k.useRef)(null),le=(0,k.useRef)(null),se=(0,k.useState)("aiClick"),Y=P()(se,2),p=Y[0],U=Y[1],Ze=(0,k.useState)(10),me=P()(Ze,2),J=me[0],w=me[1],Wr=(0,k.useState)([]),He=P()(Wr,2),Hr=He[0],be=He[1],Nr=(0,k.useState)(!1),Ne=P()(Nr,2),oe=Ne[0],te=Ne[1],Xr=(0,k.useState)([]),Xe=P()(Xr,2),Ye=Xe[0],he=Xe[1],Yr=(0,k.useState)(-1),$e=P()(Yr,2),Pe=$e[0],ge=$e[1],$r=(0,k.useState)(!0),Ve=P()($r,2),Ia=Ve[0],Ra=Ve[1],Vr=(0,k.useState)(null),Je=P()(Vr,2),j=Je[0],L=Je[1],Jr=(0,k.useState)(!1),Ke=P()(Jr,2),Kr=Ke[0],Be=Ke[1],Qr=(0,k.useState)({loading:!1,progress:0}),Qe=P()(Qr,2),Ge=Qe[0],Oa=Qe[1],Gr=(0,k.useState)(null),qe=P()(Gr,2),xe=qe[0],Ee=qe[1],qr=(0,k.useState)(null),_e=P()(qr,2),er=_e[0],Se=_e[1],_r=(0,k.useState)([]),rr=P()(_r,2),ea=rr[0],G=rr[1],ra=(0,k.useState)([]),ar=P()(ra,2),Ma=ar[0],ye=ar[1],aa=(0,k.useState)(null),tr=P()(aa,2),ce=tr[0],ne=tr[1],ta=(0,k.useState)(null),nr=P()(ta,2),Ta=nr[0],ke=nr[1],ue=(0,k.useRef)(null),na=(0,k.useState)(1),ur=P()(na,2),ir=ur[0],pe=ur[1],ua=(0,k.useState)([]),lr=P()(ua,2),ia=lr[0],de=lr[1],Ae=(0,k.useRef)(!1),la=(0,k.useState)([]),sr=P()(la,2),De=sr[0],je=sr[1],sa=(0,k.useState)(!1),or=P()(sa,2),cr=or[0],dr=or[1],we=(0,k.useRef)(null),oa=(0,k.useState)(null),fr=P()(oa,2),La=fr[0],hr=fr[1],ca=(0,k.useState)(!1),gr=P()(ca,2),da=gr[0],vr=gr[1],fa=(0,k.useState)(null),mr=P()(fa,2),za=mr[0],ha=mr[1],ga=(0,k.useState)({visible:!1,message:""}),pr=P()(ga,2),wr=pr[0],Ce=pr[1];(0,k.useEffect)(function(){if(Q.current){var l=new q.fabric.Canvas(Q.current,{isDrawingMode:!0,width:800,height:600,backgroundColor:"#fff"});f.current=l;var e=document.createElement("canvas");e.width=800,e.height=600;var n=new q.fabric.Canvas(e);n.setWidth(800),n.setHeight(600),ue.current=n,A.current=new q.fabric.Canvas(document.createElement("canvas"),{width:800,height:600});var u=new q.fabric.PencilBrush(l);return u.width=J,u.color="rgba(255, 0, 0, 0.5)",l.freeDrawingBrush=u,l.on("mouse:wheel",function(a){var r=a.e.deltaY,t=l.getZoom();t*=Math.pow(.999,r),t=Math.min(Math.max(.5,t),10),l.zoomToPoint({x:a.e.offsetX,y:a.e.offsetY},t),pe(t),a.e.preventDefault(),a.e.stopPropagation()}),l.on("mouse:down",function(){l.isDrawingMode&&(Ae.current=!0)}),l.on("mouse:up",function(){l.isDrawingMode&&Ae.current&&(Ae.current=!1)}),l.on("object:added",function(a){if(a.target&&a.target.type==="path"){var r=a.target,t=r.stroke||"unknown",d=t==="rgba(255, 0, 0, 0.5)",i=t==="rgba(0, 255, 255, 0.3)";(d||i)&&(r.uid=Date.now().toString(),de(function(o){return[].concat(re()(o),[r])}),Ae.current=!1)}}),fe(),function(){var a;l.dispose(),(a=A.current)===null||a===void 0||a.dispose()}}},[]),(0,k.useEffect)(function(){console.log("\u5206\u5272\u7ED3\u679C\u72B6\u6001\u53D8\u66F4:",!!ce)},[ce]),(0,k.useEffect)(function(){f.current&&(f.current.freeDrawingBrush.width=J)},[J]),(0,k.useEffect)(function(){var l=f.current;if(l)switch(Ea(),p){case"brush":l.isDrawingMode=!0,l.freeDrawingBrush.color="rgba(255, 0, 0, 0.5)",l.freeDrawingBrush.width=J,l.defaultCursor="crosshair";break;case"eraser":l.isDrawingMode=!0,l.freeDrawingBrush.color="rgba(255, 255, 255, 0.7)",l.freeDrawingBrush.width=J*1,l.defaultCursor="cell";break;case"transparentEraser":l.isDrawingMode=!0,l.freeDrawingBrush.color="rgba(0, 255, 255, 0.3)",l.freeDrawingBrush.width=J*1,l.defaultCursor="not-allowed";break;case"move":l.isDrawingMode=!1,l.defaultCursor="move",l.selection=!1,l.discardActiveObject(),l.renderAll(),l.off("mouse:down"),l.off("mouse:move"),l.off("mouse:up"),l.on("mouse:down",function(e){dr(!0),we.current=l.getPointer(e.e)}),l.on("mouse:move",function(e){if(cr&&we.current){var n=e.e,u=l.getPointer(n),a=u.x-we.current.x,r=u.y-we.current.y,t=l.viewportTransform;t&&(t[4]+=a,t[5]+=r,l.setViewportTransform(t)),we.current=u}}),l.on("mouse:up",function(){dr(!1),we.current=null});break;case"select":l.isDrawingMode=!1,l.selection=!0;break;case"extract":l.isDrawingMode=!0,l.freeDrawingBrush.color="rgba(0, 0, 255, 0.5)",l.freeDrawingBrush.width=J;break;case"aiClick":l.isDrawingMode=!1,xe&&ba();break;default:l.isDrawingMode=!1;break}},[p,J,xe,cr]);var fe=function(){if(f.current){var e=JSON.stringify(f.current.toJSON());Pe<Ye.length-1&&he(function(n){return n.slice(0,Pe+1)}),he(function(n){return[].concat(re()(n),[e])}),ge(function(n){return n+1})}},Ua=function(){if(!(Pe<=0)){var e=f.current;if(e){var n=Pe-1;ge(n),e.loadFromJSON(Ye[n],function(){e.renderAll()}),L(null)}}},va=function(){var e=f.current;if(e){var n=e.backgroundImage;e.getObjects().forEach(function(u){e.remove(u)}),n&&oe&&e.setBackgroundImage(n,e.renderAll.bind(e)),A.current&&A.current.clear(),be([]),L(null),G([]),de([]),fe()}},br=function(){var l=ae()(T()().mark(function e(n){var u,a,r;return T()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(n.file.status!=="uploading"){d.next=3;break}return f.current&&(f.current.setZoom(1),f.current.setViewportTransform([1,0,0,1,0,0]),pe(1)),d.abrupt("return");case 3:if(u=function(){[f,A,ue].forEach(function(o){o.current&&(o.current.clear(),o.current.discardActiveObject(),o.current.renderAll(),o===f&&(o.current.setZoom(1),o.current.setViewportTransform([1,0,0,1,0,0])))}),he([]),ge(-1),G([]),L(null),ne(null),ke(null),Ee(null),Se(null),te(!1),ye&&ye([]),de([]),pe(1),B.current=null,f.current&&f.current.setBackgroundImage("",function(){var o;(o=f.current)===null||o===void 0||o.renderAll()})},n.file.status!=="done"){d.next=16;break}if(u(),a=n.file.originFileObj,a){d.next=10;break}return s.ZP.error("\u65E0\u6CD5\u83B7\u53D6\u6587\u4EF6"),d.abrupt("return");case 10:r=new FileReader,r.onload=function(i){var o;if((o=i.target)!==null&&o!==void 0&&o.result){var g=i.target.result;Er(g)}},r.onerror=function(){s.ZP.error("\u6587\u4EF6\u8BFB\u53D6\u5931\u8D25")},r.readAsDataURL(a),d.next=17;break;case 16:n.file.status==="removed"&&(u(),be([]),s.ZP.success("\u5DF2\u6E05\u9664\u6240\u6709\u6570\u636E"));case 17:case"end":return d.stop()}},e)}));return function(n){return l.apply(this,arguments)}}(),Er=function(e){console.log("\u5F00\u59CB\u5904\u7406\u4E0A\u4F20\u56FE\u50CF...");var n=function(){console.log("\u6E05\u9664\u6240\u6709\u72B6\u6001...");var r=f.current;r&&(r.clear(),r.setBackgroundImage("",r.renderAll.bind(r)),r.renderAll(),r.off("mouse:down"),r.defaultCursor="default",r.setZoom(1),r.setViewportTransform([1,0,0,1,0,0]),pe(1)),A.current&&(A.current.clear(),A.current.renderAll()),ue.current&&(ue.current.clear(),ue.current.renderAll()),he([]),ge(-1),G([]),L(null),ne(null),ke(null),Ee(null),Se(null),te(!1),ye&&ye([]),de([]),B.current=null};n();var u=new Image;u.crossOrigin="anonymous",u.onload=function(){var a=f.current;if(!a){s.ZP.error("\u753B\u5E03\u672A\u521D\u59CB\u5316");return}a.clear(),U("aiClick"),q.fabric.Image.fromURL(e,function(r){var t=a.width||800,d=a.height||600,i=Math.min(t/r.width,d/r.height);r.scale(i),r.set({left:(t-r.width*i)/2,top:(d-r.height*i)/2,selectable:!1,evented:!1}),a.setBackgroundImage(r,a.renderAll.bind(a)),te(!0);var o=JSON.stringify(a.toJSON());he([o]),ge(0),s.ZP.success("\u56FE\u7247\u4E0A\u4F20\u6210\u529F\uFF0C\u5F00\u59CB\u6267\u884C\u5206\u5272..."),setTimeout(function(){Re(e)},100)})},u.onerror=function(){s.ZP.error("\u56FE\u7247\u52A0\u8F7D\u5931\u8D25")},u.src=e},ma=function(e){var n=e.type.startsWith("image/");if(!n)return s.ZP.error("\u53EA\u80FD\u4E0A\u4F20\u56FE\u7247\u6587\u4EF6!"),!1;console.log("\u5F00\u59CB\u4E0A\u4F20\u524D\u6E05\u7406..."),f.current&&(f.current.off("mouse:down"),f.current.defaultCursor="default",f.current.setZoom(1),f.current.setViewportTransform([1,0,0,1,0,0]),pe(1)),ne(null),Ee(null),L(null),ke(null),Se(null),te(!1),be([]),he([]),ge(-1),G([]),f.current&&(f.current.clear(),f.current.setBackgroundImage("",f.current.renderAll.bind(f.current))),A.current&&A.current.clear(),ue.current&&ue.current.clear(),B.current=null;try{var u=URL.createObjectURL(e);be([{uid:e.uid||Date.now().toString(),name:e.name,status:"done",url:u,originFileObj:e}]),setTimeout(function(){Er(u)},100)}catch(a){console.error("\u5904\u7406\u6587\u4EF6\u5931\u8D25:",a),s.ZP.error("\u6587\u4EF6\u5904\u7406\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5")}return!1},Wa=function(){var e=f.current;if(!e||!e.backgroundImage){s.ZP.warning("\u8BF7\u5148\u4E0A\u4F20\u80CC\u666F\u56FE\u7247");return}var n=e.getObjects().filter(function(O){return O.type==="path"&&(O.stroke==="rgba(255, 0, 0, 0.5)"||O.fill==="rgba(255, 0, 0, 0.5)")}),u=e.getObjects().filter(function(O){return O.type==="path"&&(O.stroke==="rgba(255, 255, 255, 0.7)"||O.fill==="rgba(255, 255, 255, 0.7)")});if(n.length===0){s.ZP.warning("\u8BF7\u5148\u7528\u7EA2\u8272\u753B\u7B14\u6D82\u62B9\u8981\u63D0\u53D6\u7684\u533A\u57DF");return}var a=e.backgroundImage,r=a.getElement(),t=a.scaleX||1,d=a.scaleY||1,i=(a.width||r.width)*t,o=(a.height||r.height)*d,g=a.left||0,S=a.top||0,b=document.createElement("canvas");b.width=i,b.height=o;var h=b.getContext("2d");if(!h){s.ZP.error("\u65E0\u6CD5\u521B\u5EFA\u4E34\u65F6\u753B\u5E03");return}h.drawImage(r,0,0,r.width,r.height,0,0,i,o);var v=document.createElement("canvas");v.width=i,v.height=o;var m=v.getContext("2d");if(!m){s.ZP.error("\u65E0\u6CD5\u521B\u5EFA\u8499\u7248\u753B\u5E03");return}m.fillStyle="black",m.fillRect(0,0,v.width,v.height),Ie(m,n,"white",g,S),u.length>0&&Ie(m,u,"black",g,S);for(var E=h.getImageData(0,0,b.width,b.height),F=m.getImageData(0,0,v.width,v.height),Z=0;Z<E.data.length;Z+=4)F.data[Z]<200&&(E.data[Z+3]=0);h.putImageData(E,0,0);var y=b.toDataURL("image/png",1);L(y),s.ZP.success("\u5206\u5272\u6210\u529F")},Ie=function(e,n,u,a,r){n.forEach(function(t){e.save(),e.fillStyle=u,e.strokeStyle=u;var d=t.strokeWidth||J;if(e.lineWidth=d,e.lineCap="round",e.lineJoin="round",e.translate(-a,-r),t._objects)t._objects.forEach(function(S){e.beginPath();var b=S.path;if(b){for(var h=0;h<b.length;h++){var v=b[h];v[0]==="M"?e.moveTo(v[1],v[2]):v[0]==="L"?e.lineTo(v[1],v[2]):v[0]==="Q"?e.quadraticCurveTo(v[1],v[2],v[3],v[4]):v[0]==="C"?e.bezierCurveTo(v[1],v[2],v[3],v[4],v[5],v[6]):v[0]==="Z"&&e.closePath()}e.stroke()}});else if(t.path){e.beginPath();for(var i=t.path,o=0;o<i.length;o++){var g=i[o];g[0]==="M"?e.moveTo(g[1],g[2]):g[0]==="L"?e.lineTo(g[1],g[2]):g[0]==="Q"?e.quadraticCurveTo(g[1],g[2],g[3],g[4]):g[0]==="C"?e.bezierCurveTo(g[1],g[2],g[3],g[4],g[5],g[6]):g[0]==="Z"&&e.closePath()}e.stroke()}e.restore()})},Ha=function(e){var n=f.current,u=A.current;if(!n||!u){s.ZP.warning("\u8BF7\u5148\u4E0A\u4F20\u56FE\u7247\u5E76\u521B\u5EFA\u8499\u7248");return}var a=n.backgroundImage;if(!a){s.ZP.warning("\u8BF7\u5148\u4E0A\u4F20\u56FE\u7247");return}var r=n.getObjects();if(r.length===0){s.ZP.warning("\u8BF7\u5148\u521B\u5EFA\u8499\u7248\u533A\u57DF");return}var t=document.createElement("canvas");t.width=n.width||800,t.height=n.height||600;var d=t.getContext("2d");if(!d){s.ZP.error("\u65E0\u6CD5\u521B\u5EFA\u4E34\u65F6\u753B\u5E03");return}var i=a.getElement(),o=a.scaleX||1,g=(a.width||1)*o,S=(a.height||1)*o,b=a.left||0,h=a.top||0;d.drawImage(i,0,0,i.width,i.height,b,h,g,S);var v=document.createElement("canvas");v.width=n.width||800,v.height=n.height||600;var m=v.getContext("2d");if(!m){s.ZP.error("\u65E0\u6CD5\u521B\u5EFA\u8499\u7248\u753B\u5E03");return}m.fillStyle="white",m.fillRect(0,0,v.width,v.height),e==="filter"?m.globalCompositeOperation="destination-out":(m.fillStyle="black",m.fillRect(0,0,v.width,v.height),m.globalCompositeOperation="destination-in"),r.forEach(function(F){if(F.type==="path"){var Z=document.createElement("canvas");Z.width=n.width||800,Z.height=n.height||600;var y=new q.fabric.StaticCanvas(Z);y.add(F),y.renderAll(),m.drawImage(Z,0,0),y.dispose()}}),d.globalCompositeOperation="destination-in",d.drawImage(v,0,0);var E=t.toDataURL("image/png",1);L(E)},Na=function(){var e=f.current;if(!e||!e.backgroundImage){s.ZP.warning("\u8BF7\u5148\u4E0A\u4F20\u56FE\u7247");return}var n=e.getObjects(),u=n[n.length-1];if(!u||u.type!=="path"){s.ZP.warning("\u8BF7\u5148\u7ED8\u5236\u63D0\u53D6\u8DEF\u5F84");return}var a=e.backgroundImage,r=new q.fabric.Image(a.getElement(),{left:a.left,top:a.top,scaleX:a.scaleX,scaleY:a.scaleY});r.clipPath=u,e.remove(u),e.add(r),e.renderAll(),fe()},pa=function(){if(j){var e=new Image;e.crossOrigin="anonymous",e.onload=function(){var g=e.naturalWidth,S=e.naturalHeight;console.log("\u4FDD\u6301\u539F\u59CB\u56FE\u50CF\u5C3A\u5BF8: ".concat(g,"x").concat(S,"\uFF0C\u4E0D\u8FDB\u884C\u4EFB\u4F55\u7F29\u653E\u5904\u7406"));var b=document.createElement("canvas");b.width=g,b.height=S;var h=b.getContext("2d",{alpha:!0,willReadFrequently:!0,desynchronized:!1});if(!h){s.ZP.error("\u521B\u5EFA\u753B\u5E03\u5931\u8D25");return}h.imageSmoothingEnabled=!1,h.webkitImageSmoothingEnabled=!1,h.mozImageSmoothingEnabled=!1,h.msImageSmoothingEnabled=!1,h.fillStyle="white",h.fillRect(0,0,g,S),h.drawImage(e,0,0);var v=b.toDataURL("image/png",1),m=document.createElement("a"),E=p==="ai"?"ai-segmented-image-white.png":"extracted-image-white.png";m.download=E,m.href=v,document.body.appendChild(m),m.click(),document.body.removeChild(m)},e.onerror=function(){s.ZP.error("\u52A0\u8F7D\u56FE\u7247\u5931\u8D25")},e.src=j;return}if(f.current){var n=f.current,u=n.getWidth(),a=n.getHeight();console.log("\u4FDD\u6301\u753B\u5E03\u539F\u59CB\u5C3A\u5BF8: ".concat(u,"x").concat(a,"\uFF0C\u4E0D\u8FDB\u884C\u4EFB\u4F55\u7F29\u653E\u6216\u538B\u7F29"));var r=document.createElement("canvas");r.width=u,r.height=a;var t=r.getContext("2d",{alpha:!0,willReadFrequently:!0,desynchronized:!1});if(!t){s.ZP.error("\u521B\u5EFA\u753B\u5E03\u5931\u8D25");return}t.imageSmoothingEnabled=!1,t.webkitImageSmoothingEnabled=!1,t.mozImageSmoothingEnabled=!1,t.msImageSmoothingEnabled=!1,t.fillStyle="white",t.fillRect(0,0,u,a);var d=n.getElement();t.drawImage(d,0,0);var i=r.toDataURL("image/png",1),o=document.createElement("a");o.download="canvas-image-white.png",o.href=i,document.body.appendChild(o),o.click(),document.body.removeChild(o)}},Fe=function(e){var n=e.target.value;if(de([]),n==="transparentEraser"&&j){var u=f.current;if(u){var a=u.backgroundImage;u.clear();var r=u.getObjects().filter(function(t){return t.type==="path"&&(t.stroke==="rgba(0, 255, 255, 0.3)"||t.fill==="rgba(0, 255, 255, 0.3)")});r.forEach(function(t){return u.remove(t)}),q.fabric.Image.fromURL(j,function(t){var d=new Image;d.onload=function(){var i=d.naturalWidth,o=d.naturalHeight,g=u.width||800,S=u.height||600,b=Math.min(g/i,S/o);t.scale(b),t.set({left:(g-i*b)/2,top:(S-o*b)/2,selectable:!1,evented:!1,data:{originalWidth:i,originalHeight:o}}),u.setBackgroundImage(t,u.renderAll.bind(u)),te(!0),u.isDrawingMode=!0,u.freeDrawingBrush.color="rgba(0, 255, 255, 0.3)",u.freeDrawingBrush.width=J*1.5,ye([]),fe()},d.src=j})}}U(n)},wa=function(e){w(e)},ba=function(){var e=f.current;if(!e){s.ZP.error("\u753B\u5E03\u672A\u521D\u59CB\u5316");return}if(!ce){s.ZP.warning("\u8BF7\u5148\u6267\u884CAI\u5206\u5272");return}U("aiClick"),e.defaultCursor="pointer",e.off("mouse:down"),s.ZP.success("\u8BF7\u70B9\u51FB\u670D\u88C5\u533A\u57DF\u8FDB\u884C\u63D0\u53D6"),ka(ce)},Ea=function(){var e=f.current;e&&(e.defaultCursor="default",e.off("mouse:down"),Se(null))},Xa=function(e){var n=f.current;if(!n){console.error("\u70B9\u51FB\u5904\u7406\uFF1A\u753B\u5E03\u4E0D\u5B58\u5728");return}if(!ce){console.error("\u70B9\u51FB\u5904\u7406\uFF1A\u5206\u5272\u56FE\u50CF\u4E0D\u5B58\u5728"),s.ZP.warning("\u8BF7\u7B49\u5F85AI\u5206\u5272\u5B8C\u6210");return}var u=n.getPointer(e.e),a=n.backgroundImage;if(!a){s.ZP.warning("\u8BF7\u5148\u4E0A\u4F20\u56FE\u7247");return}try{var r=new Image;r.crossOrigin="anonymous",r.onload=function(){try{var t=a.getElement(),d=a.scaleX||1,i=a.scaleY||1,o=a.left||0,g=a.top||0,S=t.width*d,b=t.height*i,h=u.x-o,v=u.y-g,m=Math.max(0,Math.min(1,h/S)),E=Math.max(0,Math.min(1,v/b)),F=Math.floor(m*r.width),Z=Math.floor(E*r.height),y=document.createElement("canvas");y.width=r.width,y.height=r.height;var O=y.getContext("2d",{willReadFrequently:!0});if(!O){s.ZP.error("\u65E0\u6CD5\u521B\u5EFA\u4E34\u65F6\u753B\u5E03\u4E0A\u4E0B\u6587");return}O.drawImage(r,0,0);for(var z=2,M={r:0,g:0,b:0,count:0},D=-z;D<=z;D++)for(var _=-z;_<=z;_++){var W=Math.max(0,Math.min(r.width-1,F+_)),H=Math.max(0,Math.min(r.height-1,Z+D)),$=O.getImageData(W,H,1,1).data;M.r+=$[0],M.g+=$[1],M.b+=$[2],M.count++}var ee=M.r/M.count,ve=M.g/M.count,I=M.b/M.count,K=0,V="\u80CC\u666F";if(ee>150&&ve<100&&I<100)K=3,V="\u8FDE\u8863\u88D9";else if(ve>150&&ee<100&&I<100)K=2,V="\u88E4\u5B50";else if(I>150&&ee<100&&ve<100)K=1,V="\u4E0A\u8863";else{s.ZP.info("\u8BF7\u70B9\u51FB\u670D\u88C5\u533A\u57DF");return}Sa(K,r)}catch(x){console.error("\u5904\u7406\u70B9\u51FB\u533A\u57DF\u65F6\u51FA\u9519:",x),s.ZP.error("\u5904\u7406\u70B9\u51FB\u533A\u57DF\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5")}},r.src=ce}catch(t){console.error("\u5904\u7406\u70B9\u51FB\u4E8B\u4EF6\u5931\u8D25:",t),s.ZP.error("\u5904\u7406\u70B9\u51FB\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5")}},Sa=function(e,n){var u=f.current;if(!u||!u.backgroundImage)return console.error("\u65E0\u6CD5\u53EF\u89C6\u5316\uFF1A\u753B\u5E03\u6216\u80CC\u666F\u56FE\u50CF\u4E0D\u5B58\u5728"),null;try{var a=u.backgroundImage,r=a.getElement(),t=document.createElement("canvas");t.width=r.width,t.height=r.height;var d=t.getContext("2d");if(!d)return console.error("\u65E0\u6CD5\u521B\u5EFA\u4E34\u65F6\u753B\u5E03\u4E0A\u4E0B\u6587"),null;if(j){var i=new Image;i.src=j,d.drawImage(i,0,0,t.width,t.height)}else d.drawImage(r,0,0,r.width,r.height);var o=document.createElement("canvas");o.width=n.width,o.height=n.height;var g=o.getContext("2d");if(!g)return console.error("\u65E0\u6CD5\u521B\u5EFA\u63A9\u7801\u753B\u5E03\u4E0A\u4E0B\u6587"),null;g.drawImage(n,0,0);var S=g.getImageData(0,0,o.width,o.height),b=d.getImageData(0,0,t.width,t.height),h=b.data,v=t.width/o.width,m=t.height/o.height;console.log("\u5904\u7406\u56FE\u50CF\u5C3A\u5BF8:",{\u539F\u56FE:{width:t.width,height:t.height},\u5206\u5272\u56FE:{width:o.width,height:o.height},\u6BD4\u4F8B:{x:v,y:m},\u7C7B\u522B:e});var E=0,F=0,Z=0;e===1?(E=0,F=0,Z=255):e===2?(E=0,F=255,Z=0):e===3&&(E=255,F=0,Z=0),console.log("\u76EE\u6807\u989C\u8272: RGB(".concat(E,",").concat(F,",").concat(Z,")"));for(var y={blue:0,green:0,red:0,black:0,other:0,matched:0},O=0;O<t.height;O++)for(var z=0;z<t.width;z++){var M=Math.min(o.width-1,Math.floor(z/v)),D=Math.min(o.height-1,Math.floor(O/m)),_=(D*o.width+M)*4,W=S.data[_],H=S.data[_+1],$=S.data[_+2];W<50&&H<50&&$>200?y.blue++:W<50&&H>200&&$<50?y.green++:W>200&&H<50&&$<50?y.red++:W<50&&H<50&&$<50?y.black++:y.other++;var ee=!1;(e===1&&W<50&&H<50&&$>200||e===2&&W<50&&H>200&&$<50||e===3&&W>200&&H<50&&$<50)&&(ee=!0,y.matched++);var ve=(O*t.width+z)*4;!ee&&!j&&(h[ve+3]=0)}console.log("\u5206\u5272\u56FE\u50CF\u989C\u8272\u7EDF\u8BA1:",y),d.putImageData(b,0,0);var I=t.toDataURL("image/png",1),K=e===0?"\u80CC\u666F":e===1?"\u4E0A\u8863":e===2?"\u88E4\u5B50":e===3?"\u8FDE\u8863\u88D9":"\u672A\u77E5";return G(function(V){return[].concat(re()(V),[{id:"segment-".concat(Date.now()),url:I,className:K}])}),L(I),s.ZP.success("\u5DF2\u6DFB\u52A0: ".concat(K)),I}catch(V){return console.error("\u53EF\u89C6\u5316\u5206\u5272\u7C7B\u522B\u5931\u8D25:",V),s.ZP.error("\u53EF\u89C6\u5316\u5206\u5272\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5"),null}},Ya=function(e){var n=f.current;if(n){n.clear(),te(!1);var u=new Image;u.onload=function(){var a=new q.fabric.Image(u),r=n.width||800,t=n.height||600,d=Math.min(r/a.width,t/a.height)*.8;a.scale(d),a.left=(r-a.width*d)/2,a.top=(t-a.height*d)/2,n.add(a),n.setActiveObject(a),n.renderAll(),fe()},u.src=e}},$a=function(){G([]);var e=f.current;e&&(e.clear(),e.setBackgroundImage("",e.renderAll.bind(e))),A.current&&A.current.clear(),ue.current&&ue.current.clear(),te(!1),B.current=null,L(null),ne(null),ke(null),Ee(null),Se(null),he([]),ge(-1),s.ZP.success("\u5DF2\u6E05\u7A7A\u6240\u6709\u5206\u5272\u7ED3\u679C\u548C\u5386\u53F2\u8BB0\u5F55")},Va=function(e){var n=ea.find(function(d){return d.id===e});if(G(function(d){return d.filter(function(i){return i.id!==e})}),n&&f.current){var u=f.current,a=u.getObjects().filter(function(d){return d.type==="image"});if(a.length===1){var r=a[0],t=r.getElement().src;t===n.url&&(u.clear(),te(!1),L(null),ne(null),A.current&&A.current.clear(),B.current=null,be([]))}}},ya=function(){var e=f.current;if(!e){s.ZP.error("\u753B\u5E03\u672A\u521D\u59CB\u5316");return}console.log("\u5F00\u59CB\u5E94\u7528\u6A61\u76AE\u64E6...");var n=e.getObjects().filter(function(r){return r.type==="path"&&(r.stroke==="rgba(0, 255, 255, 0.3)"||r.fill==="rgba(0, 255, 255, 0.3)")});if(console.log("\u627E\u5230 ".concat(n.length," \u4E2A\u6A61\u76AE\u64E6\u8DEF\u5F84")),n.length===0){s.ZP.warning("\u8BF7\u5148\u4F7F\u7528\u900F\u660E\u6A61\u76AE\u64E6\u5DE5\u5177\u6D82\u62B9\u8981\u64E6\u9664\u7684\u533A\u57DF");return}try{var u="";if(j)j&&(je(function(r){return[].concat(re()(r),[j])}),console.log("\u5DF2\u4FDD\u5B58\u5F53\u524D\u56FE\u50CF\u72B6\u6001\u7528\u4E8E\u64A4\u9500")),u=j;else{s.ZP.warning("\u6CA1\u6709\u53EF\u64E6\u9664\u7684\u56FE\u50CF\uFF0C\u8BF7\u5148\u5206\u5272\u56FE\u50CF");return}var a=new Image;a.crossOrigin="anonymous",a.onload=function(){console.log("\u6E90\u56FE\u50CF\u52A0\u8F7D\u6210\u529F\uFF0C\u5C3A\u5BF8:",a.width,"x",a.height);var r=document.createElement("canvas");r.width=a.naturalWidth,r.height=a.naturalHeight;var t=r.getContext("2d",{willReadFrequently:!0});if(!t){s.ZP.error("\u65E0\u6CD5\u521B\u5EFA\u4E34\u65F6\u753B\u5E03");return}t.drawImage(a,0,0,r.width,r.height);var d=e.backgroundImage;if(!d){s.ZP.error("\u65E0\u6CD5\u83B7\u53D6\u753B\u5E03\u80CC\u666F\u56FE\u50CF");return}var i=d.left||0,o=d.top||0,g=d.scaleX||1,S=d.scaleY||1,b=(d.width||r.width)*g,h=(d.height||r.height)*S;console.log("\u663E\u793A\u5C3A\u5BF8: ".concat(b,"x").concat(h,", \u4F4D\u7F6E: (").concat(i,", ").concat(o,"), \u7F29\u653E: (").concat(g,", ").concat(S,")"));var v=r.width/b,m=r.height/h;console.log("\u53D8\u6362\u6BD4\u4F8B: X=".concat(v,", Y=").concat(m)),t.globalCompositeOperation="destination-out",n.forEach(function(y,O){if(console.log("\u5904\u7406\u6A61\u76AE\u64E6\u8DEF\u5F84 ".concat(O+1,"/").concat(n.length)),t.save(),t.lineWidth=J*v*2,t.lineCap="round",t.lineJoin="round",t.translate(-i*v,-o*m),y.path){t.beginPath();for(var z=y.path,M=0;M<z.length;M++){var D=z[M];D[0]==="M"?t.moveTo(D[1]*v,D[2]*m):D[0]==="L"?t.lineTo(D[1]*v,D[2]*m):D[0]==="Q"?t.quadraticCurveTo(D[1]*v,D[2]*m,D[3]*v,D[4]*m):D[0]==="C"&&t.bezierCurveTo(D[1]*v,D[2]*m,D[3]*v,D[4]*m,D[5]*v,D[6]*m)}t.stroke()}t.restore()});var E=r.toDataURL("image/png",1);L(E),te(!0);var F=Date.now(),Z={id:"eraser-result-".concat(F),url:E,className:"\u64E6\u9664\u7ED3\u679C-".concat(F.toString().slice(-4))};G(function(y){return[].concat(re()(y),[Z])}),n.forEach(function(y){e.remove(y)}),q.fabric.Image.fromURL(E,function(y){y.set({left:i,top:o,scaleX:g,scaleY:S,selectable:!1,evented:!1}),e.setBackgroundImage(y,e.renderAll.bind(e))}),de([]),console.log("\u5DF2\u6E05\u7A7A\u7ED8\u56FE\u5386\u53F2"),fe()},a.onerror=function(r){console.error("\u52A0\u8F7D\u6E90\u56FE\u50CF\u5931\u8D25:",r),s.ZP.error("\u52A0\u8F7D\u6E90\u56FE\u50CF\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5")},a.src=u}catch(r){console.error("\u5E94\u7528\u6A61\u76AE\u64E6\u5931\u8D25:",r),s.ZP.error("\u5E94\u7528\u6A61\u76AE\u64E6\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5")}},ka=function(e){var n=f.current;if(!n){s.ZP.error("\u753B\u5E03\u672A\u521D\u59CB\u5316");return}if(!e){s.ZP.warning("\u5206\u5272\u56FE\u50CF\u6570\u636E\u4E3A\u7A7A");return}n.off("mouse:down"),U("aiClick"),n.defaultCursor="pointer",ne(e),n.on("mouse:down",function(u){if(!n.backgroundImage){s.ZP.warning("\u8BF7\u5148\u4E0A\u4F20\u56FE\u7247");return}var a=n.getPointer(u.e),r=n.backgroundImage,t=r.getElement(),d=r.scaleX||1,i=r.scaleY||1,o=r.left||0,g=r.top||0,S=t.width*d,b=t.height*i;if(a.x<o||a.x>o+S||a.y<g||a.y>g+b){s.ZP.info("\u8BF7\u70B9\u51FB\u56FE\u50CF\u533A\u57DF");return}e?(L(e),G(function(h){var v=h.some(function(m){return m.url===e});return v?h:[].concat(re()(h),[{id:"segment-click-".concat(Date.now()),url:e,className:"\u70B9\u51FB\u9009\u62E9"}])})):s.ZP.warning("\u672A\u83B7\u53D6\u5230\u5206\u5272\u7ED3\u679C")})},Da=function(e){var n=f.current;if(!n){s.ZP.error("\u753B\u5E03\u672A\u521D\u59CB\u5316");return}if(!e){s.ZP.warning("\u5206\u5272\u56FE\u50CF\u6570\u636E\u4E3A\u7A7A");return}n.off("mouse:down"),U("aiClick"),n.defaultCursor="pointer",ne(e),n.on("mouse:down",ae()(T()().mark(function u(){return T()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,n.backgroundImage){r.next=4;break}return s.ZP.warning("\u8BF7\u5148\u4E0A\u4F20\u56FE\u7247"),r.abrupt("return");case 4:L(e),G(function(t){var d=t.some(function(i){return i.url===e});return d?t:[].concat(re()(t),[{id:"segment-click-".concat(Date.now()),url:e,className:"\u5206\u5272\u7ED3\u679C"}])}),r.next=11;break;case 8:r.prev=8,r.t0=r.catch(0),s.ZP.error("\u9009\u62E9\u533A\u57DF\u5931\u8D25");case 11:case"end":return r.stop()}},u,null,[[0,8]])})))},Ja=function(){var e=f.current;if(!e||!e.backgroundImage){s.ZP.warning("\u8BF7\u5148\u4E0A\u4F20\u80CC\u666F\u56FE\u7247");return}var n=e.getObjects().filter(function(y){return y.type==="path"&&(y.stroke==="rgba(255, 0, 0, 0.5)"||y.fill==="rgba(255, 0, 0, 0.5)")});if(n.length===0){s.ZP.warning("\u8BF7\u5148\u7528\u7EA2\u8272\u753B\u7B14\u6D82\u62B9\u8981\u8865\u5145\u7684\u533A\u57DF");return}var u=e.backgroundImage,a=u.getElement(),r=u.scaleX||1,t=u.scaleY||1,d=(u.width||a.width)*r,i=(u.height||a.height)*t,o=u.left||0,g=u.top||0,S=document.createElement("canvas");S.width=d,S.height=i;var b=S.getContext("2d");if(!b){s.ZP.error("\u65E0\u6CD5\u521B\u5EFA\u4E34\u65F6\u753B\u5E03");return}b.drawImage(a,0,0,a.width,a.height,0,0,d,i);var h=document.createElement("canvas");h.width=d,h.height=i;var v=h.getContext("2d");if(!v){s.ZP.error("\u65E0\u6CD5\u521B\u5EFA\u8499\u7248\u753B\u5E03");return}v.fillStyle="black",v.fillRect(0,0,h.width,h.height),Ie(v,n,"white",o,g);for(var m=b.getImageData(0,0,S.width,S.height),E=v.getImageData(0,0,h.width,h.height),F=0;F<m.data.length;F+=4)E.data[F]<200&&(m.data[F+3]=0);b.putImageData(m,0,0);var Z=S.toDataURL("image/png",1);ke(Z)},Ca=function(){var e=f.current;if(!e||!e.backgroundImage){s.ZP.warning("\u8BF7\u5148\u4E0A\u4F20\u80CC\u666F\u56FE\u7247");return}var n=e.getObjects().filter(function(I){return I.type==="path"&&(I.stroke==="rgba(255, 0, 0, 0.5)"||I.fill==="rgba(255, 0, 0, 0.5)")});if(n.length===0){s.ZP.warning("\u8BF7\u5148\u7528\u7EA2\u8272\u753B\u7B14\u6D82\u62B9\u8981\u63D0\u53D6\u7684\u533A\u57DF");return}var u=e.backgroundImage,a=u.getElement(),r=a.naturalWidth,t=a.naturalHeight,d=u.scaleX||1,i=u.scaleY||1,o=(u.width||a.width)*d,g=(u.height||a.height)*i,S=u.left||0,b=u.top||0,h=document.createElement("canvas");h.width=r,h.height=t;var v=h.getContext("2d");if(!v){s.ZP.error("\u65E0\u6CD5\u521B\u5EFA\u4E34\u65F6\u753B\u5E03");return}v.drawImage(a,0,0,r,t);var m=document.createElement("canvas");m.width=r,m.height=t;var E=m.getContext("2d");if(!E){s.ZP.error("\u65E0\u6CD5\u521B\u5EFA\u8499\u7248\u753B\u5E03");return}E.fillStyle="black",E.fillRect(0,0,m.width,m.height);var F=r/o,Z=t/g;E.fillStyle="white",E.strokeStyle="white",E.lineWidth=J*F,E.lineCap="round",E.lineJoin="round",n.forEach(function(I){if(E.save(),E.translate(-S*F,-b*Z),I.path){var K=I.path;E.beginPath();for(var V=0;V<K.length;V++){var x=K[V];x[0]==="M"?E.moveTo(x[1]*F,x[2]*Z):x[0]==="L"?E.lineTo(x[1]*F,x[2]*Z):x[0]==="Q"?E.quadraticCurveTo(x[1]*F,x[2]*Z,x[3]*F,x[4]*Z):x[0]==="C"&&E.bezierCurveTo(x[1]*F,x[2]*Z,x[3]*F,x[4]*Z,x[5]*F,x[6]*Z)}E.stroke()}E.restore()});for(var y=v.getImageData(0,0,h.width,h.height),O=E.getImageData(0,0,m.width,m.height),z=0;z<y.data.length;z+=4)O.data[z]<200&&(y.data[z+3]=0);v.putImageData(y,0,0);var M=h.toDataURL("image/png",1);if(j){je(function(I){return[].concat(re()(I),[j])}),console.log("\u5DF2\u4FDD\u5B58\u5F53\u524D\u56FE\u50CF\u72B6\u6001\u7528\u4E8E\u64A4\u9500");var D=document.createElement("canvas");D.width=r,D.height=t;var _=D.getContext("2d");if(!_){s.ZP.error("\u65E0\u6CD5\u521B\u5EFA\u5408\u6210\u753B\u5E03");return}var W=new Image,H=new Image;W.crossOrigin="anonymous",H.crossOrigin="anonymous";var $=0,ee=function(){if($===2){var K=Math.max(W.naturalWidth,H.naturalWidth),V=Math.max(W.naturalHeight,H.naturalHeight);D.width=K,D.height=V,_.drawImage(W,0,0,K,V),_.drawImage(H,0,0,K,V);var x=D.toDataURL("image/png",1);L(x);var Ba=Date.now();G(function(Oe){return[].concat(re()(Oe),[{id:"composite-".concat(Ba),url:x,className:"\u9AD8\u6E05\u53E0\u52A0\u7ED3\u679C"}])}),n.forEach(function(Oe){e.remove(Oe)}),e.renderAll()}};W.onload=function(){$++,ee()},H.onload=function(){$++,ee()},W.src=j,H.src=M}else{L(M);var ve=Date.now();G(function(I){return[].concat(re()(I),[{id:"brush-".concat(ve),url:M,className:"\u624B\u7ED8\u63D0\u53D6"}])}),s.ZP.success("\u624B\u7ED8\u533A\u57DF\u63D0\u53D6\u6210\u529F"),n.forEach(function(I){e.remove(I)}),e.renderAll()}},Ka=function(){var e=f.current;if(e)try{console.log("\u6E05\u9664\u5DE6\u4FA7\u753B\u5E03\u6807\u8BB0\u5F00\u59CB");var n=e.getObjects();if(console.log("\u5DE6\u4FA7\u753B\u5E03\u5BF9\u8C61\u6570\u91CF: ".concat(n.length)),n.forEach(function(a,r){console.log("\u753B\u5E03\u5BF9\u8C61 ".concat(r,": \u7C7B\u578B=").concat(a.type,", \u989C\u8272=").concat(a.stroke||a.fill||"unknown"))}),n.length===0){s.ZP.info("\u5DE6\u4FA7\u753B\u5E03\u5DF2\u7ECF\u662F\u7A7A\u7684");return}var u=n.filter(function(a){return a.type==="path"});if(u.length===0){s.ZP.info("\u6CA1\u6709\u53EF\u5220\u9664\u7684\u6807\u8BB0");return}console.log("\u627E\u5230 ".concat(u.length," \u4E2A\u53EF\u5220\u9664\u7684\u8DEF\u5F84\u5BF9\u8C61")),u.forEach(function(a){e.remove(a)}),e.renderAll(),console.log("\u753B\u5E03\u6E32\u67D3\u5B8C\u6210"),fe()}catch(a){console.error("\u6E05\u9664\u5DE6\u4FA7\u753B\u5E03\u9519\u8BEF:",a),s.ZP.error("\u6E05\u9664\u5DE6\u4FA7\u753B\u5E03\u6807\u8BB0\u5931\u8D25")}},Qa=function(){if(!j){s.ZP.info("\u53F3\u4FA7\u753B\u5E03\u6682\u65E0\u5185\u5BB9");return}L(null)},Fa=function(){var e=f.current;e&&(e.setZoom(1),e.setViewportTransform([1,0,0,1,0,0]),e.renderAll(),pe(1))},Ga=function(){var e=f.current;if(!e){s.ZP.error("\u753B\u5E03\u672A\u521D\u59CB\u5316");return}var n=e.getObjects();if(console.log("\u753B\u5E03\u4E0A\u6709 ".concat(n.length," \u4E2A\u5BF9\u8C61")),n.length===0){s.ZP.info("\u6CA1\u6709\u53EF\u64A4\u9500\u7684\u7ED8\u56FE\u64CD\u4F5C");return}var u=n.filter(function(o){return o.type==="path"});if(console.log("\u627E\u5230 ".concat(u.length," \u4E2A\u8DEF\u5F84\u5BF9\u8C61")),u.length===0){s.ZP.info("\u6CA1\u6709\u53EF\u64A4\u9500\u7684\u7ED8\u56FE\u64CD\u4F5C");return}try{var a=u.filter(function(o){return o.stroke==="rgba(0, 255, 255, 0.3)"});console.log("\u627E\u5230 ".concat(a.length," \u4E2A\u6A61\u76AE\u64E6\u8DEF\u5F84"));var r=null,t=0,d=X(p,"transparentEraser")&&a.length>0?a:u;if(d.forEach(function(o){var g=o.uid;g&&parseInt(g)>t&&(t=parseInt(g),r=o)}),r?console.log("\u627E\u5230\u6700\u65B0\u8DEF\u5F84\uFF0C\u65F6\u95F4\u6233: ".concat(t)):(r=d[d.length-1],console.log("\u672A\u627E\u5230\u5E26\u65F6\u95F4\u6233\u7684\u8DEF\u5F84\uFF0C\u4F7F\u7528\u6700\u540E\u4E00\u4E2A\u8DEF\u5F84")),r){var i=r.stroke||"unknown";console.log("\u51C6\u5907\u79FB\u9664\u6700\u540E\u4E00\u4E2A\u7ED8\u5236\u7684\u8DEF\u5F84: \u989C\u8272=".concat(i,", ID=").concat(r.uid||"\u65E0ID")),e.remove(r),ia.length>0&&de(function(o){return o.filter(function(g){return g!==r})}),e.renderAll(),fe(),s.ZP.success("\u64A4\u56DE\u6210\u529F")}else s.ZP.info("\u672A\u627E\u5230\u53EF\u64A4\u9500\u7684\u8DEF\u5F84")}catch(o){console.error("\u64A4\u9500\u7ED8\u56FE\u64CD\u4F5C\u5931\u8D25:",o),s.ZP.error("\u64A4\u9500\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5")}},Sr=function(){if(De.length===0){s.ZP.info("\u6CA1\u6709\u53EF\u64A4\u9500\u7684\u64CD\u4F5C");return}var e=De[De.length-1];if(L(e),p==="transparentEraser"){var n=f.current;if(n){var u=n.backgroundImage;if(u){var a=u.left||0,r=u.top||0,t=u.scaleX||1,d=u.scaleY||1;q.fabric.Image.fromURL(e,function(i){i.set({left:a,top:r,scaleX:t,scaleY:d,selectable:!1,evented:!1}),n.setBackgroundImage(i,n.renderAll.bind(n));var o=n.getObjects().filter(function(g){return g.type==="path"&&(g.stroke==="rgba(0, 255, 255, 0.3)"||g.fill==="rgba(0, 255, 255, 0.3)")});o.forEach(function(g){n.remove(g)}),n.renderAll()})}}}je(function(i){return i.slice(0,i.length-1)}),de([]),s.ZP.success("\u64A4\u56DE\u6210\u529F")},qa=function(){var l=ae()(T()().mark(function e(){var n,u,a;return T()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=localStorage.getItem("OSSData"),!n){t.next=8;break}if(u=JSON.parse(n),a=Number(u.expire),!(a>Date.now())){t.next=8;break}return hr(u),t.abrupt("return",u);case 8:return t.next=10,Za();case 10:return t.abrupt("return",t.sent);case 13:return t.prev=13,t.t0=t.catch(0),console.error("\u83B7\u53D6OSS\u6570\u636E\u5931\u8D25:",t.t0),s.ZP.error("\u83B7\u53D6OSS\u914D\u7F6E\u5931\u8D25"),t.abrupt("return",null);case 18:case"end":return t.stop()}},e,null,[[0,13]])}));return function(){return l.apply(this,arguments)}}(),Za=function(){var l=ae()(T()().mark(function e(){var n,u,a,r,t;return T()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,fetch("https://mzbapi.hao-a.com/file/oss_sts",{method:"POST",headers:{"Content-Type":"application/json","Authen-Business":"provider","Authen-Mchno":"1000888",Environment:"production"}});case 3:return n=i.sent,i.next=6,n.json();case 6:if(u=i.sent,!u.status){i.next=16;break}return a=u.data.credentials||{},r=u.data.ossConfig||{},t={expire:Date.parse(new Date(a==null?void 0:a.expiration).toString()),host:r.host,domain:r.domain,accessKeyId:a.accessKeyId,signature:r.signature,policy:r.policy,regionId:r.regionId,securityToken:a.securityToken,bucket:r.bucket},localStorage.setItem("OSSData",JSON.stringify(t)),hr(t),i.abrupt("return",t);case 16:return s.ZP.warning(u.message||"\u83B7\u53D6OSS\u914D\u7F6E\u5931\u8D25"),i.abrupt("return",null);case 18:i.next=25;break;case 20:return i.prev=20,i.t0=i.catch(0),console.error("\u521D\u59CB\u5316STS\u5931\u8D25:",i.t0),s.ZP.error("\u521D\u59CB\u5316OSS STS\u5931\u8D25"),i.abrupt("return",null);case 25:case"end":return i.stop()}},e,null,[[0,20]])}));return function(){return l.apply(this,arguments)}}(),Pa=function(){var l=ae()(T()().mark(function e(n){var u,a,r,t,d,i,o,g,S;return T()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(n){h.next=3;break}return s.ZP.warning("\u8BF7\u5148\u751F\u6210\u5206\u5272\u56FE\u50CF"),h.abrupt("return");case 3:return h.prev=3,vr(!0),s.ZP.loading({content:"\u6B63\u5728\u4E0A\u4F20\u56FE\u50CF...",key:"ossUpload"}),u=n,h.prev=7,h.next=10,Lr(n);case 10:u=h.sent,h.next=16;break;case 13:h.prev=13,h.t0=h.catch(7),u=n;case 16:return h.next=18,fetch(u).then(function(v){return v.blob()});case 18:return a=h.sent,r="segment_".concat(Date.now(),".png"),t=new File([a],r,{type:"image/png"}),d=new FormData,d.append("bucket","default"),d.append("media","image"),d.append("files",t),h.next=27,fetch("https://mzbapi.hao-a.com/file/oss_upload",{method:"POST",headers:{Accept:"*/*","Authen-Business":"provider","Authen-Mchno":"1000888",Environment:"production"},body:d});case 27:return i=h.sent,h.next=30,i.json();case 30:o=h.sent,o.status?(g=o.data.url||o.data.input_url,ha(g),S="https://mzb.tuiyouquan.com/draw/fuzhuangshangshentongzhuang/6819a23e9e28e207ea5f0fce/?image_path=".concat(encodeURIComponent(g)),s.ZP.success({content:"\u4E0A\u4F20\u6210\u529F\uFF0C\u6B63\u5728\u8DF3\u8F6C...",key:"ossUpload"}),window.open(S,"_blank")):s.ZP.error({content:o.message||"\u4E0A\u4F20\u5931\u8D25",key:"ossUpload"}),h.next=37;break;case 34:h.prev=34,h.t1=h.catch(3),s.ZP.error({content:"\u4E0A\u4F20\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5",key:"ossUpload"});case 37:return h.prev=37,vr(!1),h.finish(37);case 40:case"end":return h.stop()}},e,null,[[3,34,37,40],[7,13]])}));return function(n){return l.apply(this,arguments)}}(),Aa=function(){var l=ae()(T()().mark(function e(){return T()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(j){u.next=3;break}return s.ZP.warning("\u8BF7\u5148\u5206\u5272\u56FE\u50CF"),u.abrupt("return");case 3:Pa(j);case 4:case"end":return u.stop()}},e)}));return function(){return l.apply(this,arguments)}}(),Re=function(){var l=ae()(T()().mark(function e(n){var u,a,r,t;return T()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(i.prev=0,f.current&&(f.current.off("mouse:down"),f.current.defaultCursor="default"),ne(null),Ee(null),L(null),Be(!0),Ce({visible:!1,message:""}),s.ZP.loading({content:"\u6B63\u5728\u5206\u5272...",key:"segmentation"}),u=n,u.startsWith("data:")){i.next=25;break}return i.prev=10,i.next=13,fetch(n);case 13:return a=i.sent,i.next=16,a.blob();case 16:return r=i.sent,i.next=19,new Promise(function(o){var g=new FileReader;g.onloadend=function(){return o(g.result)},g.readAsDataURL(r)});case 19:u=i.sent,i.next=25;break;case 22:throw i.prev=22,i.t0=i.catch(10),new Error("\u56FE\u50CF\u8F6C\u6362\u5931\u8D25\uFF0C\u8BF7\u786E\u4FDD\u56FE\u50CF\u53EF\u8BBF\u95EE");case 25:return i.prev=25,i.next=28,Mr(u);case 28:if(t=i.sent,t){i.next=34;break}return s.ZP.error({content:"\u5206\u5272\u5931\u8D25",key:"segmentation"}),Be(!1),Ce({visible:!0,message:"\u670D\u52A1\u5668\u8FD4\u56DE\u7A7A\u7ED3\u679C\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC\u8FDE\u63A5\u5E76\u91CD\u8BD5"}),i.abrupt("return");case 34:ne(t),U("aiClick"),Da(t),s.ZP.success({content:"\u5206\u5272\u5B8C\u6210\uFF0C\u70B9\u51FB\u670D\u88C5\u663E\u793A\u7ED3\u679C",key:"segmentation"}),i.next=44;break;case 40:i.prev=40,i.t1=i.catch(25),s.ZP.error({content:"\u5206\u5272\u670D\u52A1\u6682\u65F6\u4E0D\u53EF\u7528",key:"segmentation",duration:4}),Ce({visible:!0,message:"\u8FDE\u63A5\u670D\u52A1\u5668\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC\u3002\u9519\u8BEF: "+(i.t1 instanceof Error?i.t1.message:"\u672A\u77E5\u9519\u8BEF")});case 44:i.next=50;break;case 46:i.prev=46,i.t2=i.catch(0),s.ZP.error({content:"\u5904\u7406\u56FE\u50CF\u51FA\u9519",key:"segmentation",duration:4}),Ce({visible:!0,message:"\u5904\u7406\u56FE\u50CF\u51FA\u9519: "+(i.t2 instanceof Error?i.t2.message:"\u672A\u77E5\u9519\u8BEF")});case 50:return i.prev=50,Be(!1),i.finish(50);case 53:case"end":return i.stop()}},e,null,[[0,46,50,53],[10,22],[25,40]])}));return function(n){return l.apply(this,arguments)}}();return(0,c.jsxs)("div",{className:"draw-page",children:[(0,c.jsx)("div",{className:"tools-panel",children:(0,c.jsx)(Fr.Z,{title:"\u7ED8\u56FE\u5DE5\u5177",bordered:!1,children:(0,c.jsxs)(Te.Z,{direction:"vertical",style:{width:"100%"},children:[(0,c.jsx)(Le.ZP.Group,{value:p,onChange:Fe,buttonStyle:"solid",children:(0,c.jsx)(ie.Z,{title:"\u667A\u80FD\u9009\u533A (\u70B9\u51FB\u4EA4\u4E92)",children:(0,c.jsx)(Le.ZP.Button,{value:"aiClick",children:"\u{1F446}"})})}),(0,c.jsxs)("div",{style:{marginTop:"10px"},children:[(0,c.jsxs)("div",{style:{padding:"12px",backgroundColor:"#f0f9ff",borderRadius:"4px",marginBottom:"12px",fontSize:"14px",lineHeight:"1.5"},children:[(0,c.jsx)("div",{style:{fontWeight:"bold",marginBottom:"8px"},children:"\u64CD\u4F5C\u6307\u5357:"}),(0,c.jsxs)("ol",{style:{paddingLeft:"20px",margin:0},children:[(0,c.jsx)("li",{children:"\u70B9\u51FB\u56FE\u50CF\u63D0\u53D6\u670D\u88C5"}),(0,c.jsx)("li",{children:"\u82E5\u8981\u6DFB\u52A0\u66F4\u591A\u533A\u57DF\uFF0C\u4F7F\u7528\u4E0B\u65B9\u753B\u7B14\u5DE5\u5177\u5E76\u6D82\u62B9"}),(0,c.jsx)("li",{children:'\u70B9\u51FB"\u53E0\u52A0\u63D0\u53D6"\u6309\u94AE\u6DFB\u52A0\u6D82\u62B9\u533A\u57DF'}),(0,c.jsx)("li",{children:"\u4F7F\u7528\u6A61\u76AE\u64E6\u53BB\u9664\u4E0D\u9700\u8981\u7684\u90E8\u5206"})]})]}),(0,c.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"12px"},children:[(0,c.jsx)(ie.Z,{title:"\u753B\u7B14 (\u6DFB\u52A0\u533A\u57DF)",children:(0,c.jsx)(N.ZP,{icon:(0,c.jsx)(Ar.Z,{}),onClick:function(){return Fe({target:{value:"brush"}})},type:X(p,"brush")?"primary":"default",style:{flex:1,marginRight:"8px"},children:"\u753B\u7B14"})}),(0,c.jsx)(ie.Z,{title:"\u6A61\u76AE\u64E6 (\u64E6\u9664\u533A\u57DF)",children:(0,c.jsx)(N.ZP,{icon:(0,c.jsx)(Br.Z,{}),onClick:function(){return Fe({target:{value:"transparentEraser"}})},type:X(p,"transparentEraser")?"primary":"default",style:{flex:1,marginRight:"8px"},children:"\u6A61\u76AE\u64E6"})}),(0,c.jsx)(ie.Z,{title:"\u79FB\u52A8 (\u62D6\u52A8\u753B\u5E03)",children:(0,c.jsx)(N.ZP,{icon:(0,c.jsx)("svg",{viewBox:"64 64 896 896",focusable:"false","data-icon":"drag",width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true",children:(0,c.jsx)("path",{d:"M909.3 506.3L781.7 405.6a7.23 7.23 0 00-11.7 5.7V476H548V254h64.8c6 0 9.4-7 5.7-11.7L517.7 114.7a7.14 7.14 0 00-11.3 0L405.6 242.3a7.23 7.23 0 005.7 11.7H476v222H254v-64.8c0-6-7-9.4-11.7-5.7L114.7 506.3a7.14 7.14 0 000 11.3l127.5 100.8c4.7 3.7 11.7.4 11.7-5.7V548h222v222h-64.8c-6 0-9.4 7-5.7 11.7l100.8 127.5c2.9 3.7 8.5 3.7 11.3 0l100.8-127.5c3.7-4.7.4-11.7-5.7-11.7H548V548h222v64.8c0 6 7 9.4 11.7 5.7l127.5-100.8a7.3 7.3 0 00.1-11.4z"})}),onClick:function(){return Fe({target:{value:"move"}})},type:X(p,"move")?"primary":"default",style:{flex:1},children:"\u79FB\u52A8"})})]}),X(p,"brush","transparentEraser","move")&&(0,c.jsx)(N.ZP,{onClick:function(){return Fe({target:{value:"aiClick"}})},style:{width:"100%",marginBottom:"12px"},children:"\u8FD4\u56DE\u667A\u80FD\u9009\u533A"}),X(p,"brush","transparentEraser","move")&&(0,c.jsxs)("div",{className:"slider-container",style:{marginBottom:"12px"},children:[(0,c.jsx)("span",{children:"\u753B\u7B14\u5927\u5C0F:"}),(0,c.jsx)(Zr.Z,{min:1,max:50,value:J,onChange:wa})]}),X(p,"transparentEraser","move")&&(0,c.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[(0,c.jsx)(N.ZP,{type:"primary",onClick:ya,style:{flex:1,marginRight:"8px"},children:"\u5E94\u7528\u64E6\u9664"}),(0,c.jsx)(ie.Z,{title:"\u6062\u590D\u4E0A\u4E00\u7248\u672C",children:(0,c.jsx)(N.ZP,{onClick:Sr,icon:(0,c.jsx)(Ue.Z,{}),disabled:De.length===0})})]}),X(p,"brush","move")&&(0,c.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[(0,c.jsx)(N.ZP,{type:"primary",onClick:Ca,disabled:!oe,style:{flex:1,marginRight:"8px"},children:"\u53E0\u52A0\u63D0\u53D6"}),(0,c.jsx)(ie.Z,{title:"\u64A4\u9500",children:(0,c.jsx)(N.ZP,{onClick:Sr,icon:(0,c.jsx)(Ue.Z,{}),disabled:De.length===0})})]}),X(p,"aiClick")&&(0,c.jsx)("div",{style:{width:"100%"},children:(0,c.jsx)(N.ZP,{type:"primary",onClick:function(){var e=f.current;if(!e||!e.backgroundImage){s.ZP.warning("\u8BF7\u5148\u4E0A\u4F20\u56FE\u7247");return}var n=e.backgroundImage,u=n.getElement();Re(u.src)},style:{width:"100%",marginBottom:"12px"},children:"\u6267\u884C\u5206\u5272"})})]}),(0,c.jsx)("div",{style:{marginTop:"8px",fontSize:"12px",color:"#666",backgroundColor:"#f0f0f0",padding:"6px",borderRadius:"4px",textAlign:"center",marginBottom:"12px"},children:"\u63D0\u793A: \u4F7F\u7528\u9F20\u6807\u6EDA\u8F6E\u53EF\u653E\u5927/\u7F29\u5C0F\u753B\u5E03"}),(0,c.jsxs)(Te.Z,{wrap:!0,children:[(0,c.jsx)(ie.Z,{title:"\u6E05\u9664\u8499\u7248",children:(0,c.jsx)(N.ZP,{icon:(0,c.jsx)(We.Z,{}),onClick:va})}),(0,c.jsx)(ie.Z,{title:"\u4E0B\u8F7D",children:(0,c.jsx)(N.ZP,{icon:(0,c.jsx)(xr.Z,{}),onClick:pa})})]}),(0,c.jsx)(Pr.Z,{name:"image",listType:"picture",fileList:Hr,onChange:br,beforeUpload:ma,maxCount:1,accept:"image/*",onRemove:function(){br({file:{status:"removed"}})},showUploadList:{showPreviewIcon:!0,showRemoveIcon:!0,removeIcon:(0,c.jsx)(We.Z,{title:"\u5220\u9664\u56FE\u7247\u5E76\u6E05\u9664\u7F16\u8F91",style:{color:"#ff4d4f"}})},children:(0,c.jsx)(N.ZP,{icon:(0,c.jsx)(jr.Z,{}),type:"primary",size:"large",style:{width:"100%",marginTop:"8px"},children:"\u4E0A\u4F20\u56FE\u7247"})}),j&&(0,c.jsx)("div",{style:{marginTop:"16px"},children:(0,c.jsx)(N.ZP,{type:"primary",icon:(0,c.jsx)(Ir.Z,{}),onClick:Aa,loading:da,style:{width:"100%"},children:"\u4E0A\u4F20\u5230\u670D\u88C5\u4E0A\u8EAB"})})]})})}),(0,c.jsxs)("div",{className:"canvas-container",style:{marginTop:"16px",border:"1px solid #ddd",backgroundColor:"#fff",display:"flex",flexDirection:"row",padding:"10px",gap:"20px",position:"relative"},children:[Ge.loading&&(0,c.jsxs)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(255, 255, 255, 0.7)",zIndex:100},children:[(0,c.jsx)(ze.Z,{size:"large"}),(0,c.jsxs)("div",{style:{marginTop:"10px"},children:["\u8FDE\u63A5\u4E2D (",Math.round(Ge.progress*100),"%)"]})]}),(0,c.jsxs)("div",{style:{width:"800px",height:"600px",position:"relative"},children:[(0,c.jsx)("canvas",{ref:Q}),ir!==1&&(0,c.jsxs)("div",{style:{position:"absolute",top:"10px",right:"10px",padding:"4px 8px",backgroundColor:"rgba(0, 0, 0, 0.6)",color:"white",borderRadius:"4px",fontSize:"12px",zIndex:100,display:"flex",alignItems:"center",gap:"8px"},children:[(0,c.jsxs)("span",{children:["\u7F29\u653E\u6BD4\u4F8B: ",Math.round(ir*100),"%"]}),(0,c.jsx)(N.ZP,{size:"small",onClick:Fa,type:"link",style:{color:"#fff",padding:"0 4px",marginLeft:"4px",fontSize:"12px"},children:"\u91CD\u7F6E"})]}),oe&&X(p,"aiClick")&&xe&&(0,c.jsx)("div",{style:{position:"absolute",top:"10px",left:"10px",padding:"5px 10px",backgroundColor:"rgba(0, 0, 0, 0.7)",color:"white",borderRadius:"4px",fontSize:"16px",zIndex:5},children:"\u70B9\u51FB\u56FE\u7247\u4EFB\u610F\u533A\u57DF\u9009\u62E9\u8981\u63D0\u53D6\u7684\u90E8\u5206"}),oe&&X(p,"aiClick")&&ce&&(0,c.jsx)("div",{style:{position:"absolute",top:"10px",left:"10px",padding:"5px 10px",backgroundColor:"rgba(0, 0, 0, 0.7)",color:"white",borderRadius:"4px",fontSize:"16px",zIndex:5},children:"\u70B9\u51FB\u56FE\u7247\u67E5\u770B\u5206\u5272\u7ED3\u679C"}),oe&&X(p,"brush")&&(0,c.jsx)("div",{style:{position:"absolute",top:"10px",left:"10px",padding:"5px 10px",backgroundColor:"rgba(0, 0, 0, 0.7)",color:"white",borderRadius:"4px",fontSize:"16px",zIndex:5},children:'\u4F7F\u7528\u753B\u7B14\u6D82\u62B9\u8981\u6DFB\u52A0\u7684\u533A\u57DF\uFF0C\u7136\u540E\u70B9\u51FB"\u53E0\u52A0\u63D0\u53D6"'})]}),(0,c.jsxs)("div",{className:"canvas-container",style:{width:"800px",height:"600px",position:"relative",backgroundColor:"#fff"},children:[oe&&j&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("img",{src:j,alt:"\u62A0\u56FE\u7ED3\u679C",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"contain"}}),X(p,"aiClick")&&er!==null&&le.current&&(0,c.jsxs)("div",{style:{position:"absolute",top:"10px",left:"10px",padding:"5px 10px",backgroundColor:"rgba(0, 0, 0, 0.7)",color:"white",borderRadius:"4px",fontSize:"16px"},children:["\u5F53\u524D\u9009\u4E2D: ",le.current.getClassNames()[er]]}),X(p,"transparentEraser")&&(0,c.jsx)("div",{style:{position:"absolute",top:"10px",left:"10px",padding:"5px 10px",backgroundColor:"rgba(0, 0, 0, 0.7)",color:"white",borderRadius:"4px",fontSize:"16px",zIndex:5},children:"\u4F7F\u7528\u6A61\u76AE\u64E6\u6D82\u62B9\u8981\u64E6\u9664\u7684\u533A\u57DF"})]}),!j&&oe&&(0,c.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",color:"#999",fontSize:"16px"},children:X(p,"transparentEraser")?"\u8BF7\u5148\u5206\u5272\u51FA\u56FE\u50CF\u5185\u5BB9":ce?"\u70B9\u51FB\u5DE6\u4FA7\u56FE\u7247\u663E\u793A\u5206\u5272\u7ED3\u679C":"\u8BF7\u7B49\u5F85\u5206\u5272\u5B8C\u6210\u6216\u70B9\u51FB\u5DE6\u4FA7\u56FE\u7247\u9009\u62E9\u8981\u63D0\u53D6\u7684\u533A\u57DF"}),!oe&&(0,c.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",color:"#999",fontSize:"16px"},children:"\u8BF7\u5148\u4E0A\u4F20\u56FE\u7247"}),Kr&&(0,c.jsxs)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(255, 255, 255, 0.7)",zIndex:10},children:[(0,c.jsx)(ze.Z,{size:"large"}),(0,c.jsx)("div",{style:{marginTop:"16px"},children:"\u6267\u884C\u5206\u5272\u4E2D..."})]}),wr.visible&&(0,c.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(255, 255, 255, 0.9)",zIndex:11},children:(0,c.jsxs)("div",{style:{backgroundColor:"#fff1f0",border:"1px solid #ffa39e",padding:"16px",borderRadius:"4px",maxWidth:"80%",textAlign:"center"},children:[(0,c.jsx)("div",{style:{color:"#cf1322",marginBottom:"8px",fontWeight:"bold"},children:"\u7F51\u7EDC\u8FDE\u63A5\u9519\u8BEF"}),(0,c.jsx)("div",{style:{marginBottom:"16px"},children:wr.message}),(0,c.jsx)(N.ZP,{type:"primary",onClick:function(){var e;if(Ce({visible:!1,message:""}),(e=f.current)!==null&&e!==void 0&&e.backgroundImage){var n=f.current.backgroundImage,u=n.getElement();Re(u.src)}},danger:!0,children:"\u91CD\u65B0\u5C1D\u8BD5"})]})})]})]})]})},Ur=zr},24960:function(){},26759:function(){},56272:function(){}}]);
